# CLAUDE.md - プロジェクトルール

## プロジェクト概要
- **プロジェクト名**: パン・チルトAI追跡カメラアプリ（ペット見守り）
- **目的**: YOLOv8を用いたリアルタイムペット検出・追跡技術の習得、サーボドライバによるパン・チルト制御の理解、検出結果の可視化とSlack連携による通知ワークフローの習得
- **対象**: プログラミング初心者、Raspberry Pi入門者、IoTデバイスを用いたペットモニタリングを学びたいユーザー

## 開発ルール

### 業務開始時の必須確認事項
- **要件定義書の確認**: 業務開始時は必ず要件定義書を読み返し、最新の要件と仕様を確認する
- **プロジェクト状況把握**: 現在の進捗状況と残タスクを確認する
- **変更履歴確認**: 前回からの変更点や更新事項をチェックする

### コーディング規約
- **言語**: Python 3.9以上
- **コーディングスタイル**: PEP8準拠
- **ライブラリ**: ultralytics（YOLOv8）、adafruit-circuitpython-pca9685（Servo Driver制御）、opencv-python（映像入力・描画）、requests（Slack Webhook通知）、python-dotenv（環境変数管理）
- **コメント規約**:
  - `COMMENT_STYLE_GUIDE.md` に従う
  - 日本語でわかりやすくコメントを記入する
  - コードの可読性を損なわない程度に適切な量で記載
  - 複雑な処理や重要な判定部分には必ずコメントを追加
  - 関数・クラスの目的と動作を簡潔に説明
  - 初心者向け教材として理解しやすい説明を心がける
- **Pythonコーディング規約**:
  - `python_coding_guidelines.md` に従う
  - PEP 8準拠（4スペースインデント、命名規則など）
  - `if __name__ == "__main__":` を実行可能ファイルに必須記載
  - グローバルなコード実行は関数内に移動
  - 全関数・クラスに docstring を記載
  - try-finally でリソースのクリーンアップを確実に実行
- **関数分割**: 機能ごとに適切に分割
- **エラーハンドリング**: 必須実装

### ファイル構成ルール
- **メインスクリプト**: `main.py`
- **ドキュメント**: `README.md`（英語で記載）
- **依存関係**: `requirements.txt`
- **ライセンス**: `LICENSE`
- **要件定義**: `docs/12-001_パン・チルトAI追跡カメラアプリ_要件定義書.md`
- **設計書**: `docs/pan_tilt_tracking_design.md`

### セキュリティルール
- **権限**: 最小権限の原則
- **入力検証**: 全ての引数とパラメータを検証
- **エラー情報**: 機密情報の漏洩防止
- **機密情報管理**: 
  - ユーザー名、パスワード、APIキー、秘密鍵などの機密情報をGitHubにアップロードしない
  - 設定ファイルや環境変数ファイル（.env等）は.gitignoreに追加
  - コード内にハードコードされた機密情報がないことを確認
- **リポジトリ更新前チェック**: 
  - コミット前に必ず機密情報が含まれていないかコードレビューを実施
  - git add前にファイル内容を再確認
  - .gitignoreの設定が適切であることを確認

### テストルール
- **機能テスト**: 実装した機能の動作確認必須
- **引数テスト**: 各コマンドライン引数の検証
- **エラーテスト**: 異常系の動作確認
- **割り込みテスト**: 適切な終了処理の確認

### ドキュメントルール
- **README**: 英語で記載し、安全注意事項を必ず記載
- **使用例**: 具体的なコマンド例を提供
- **トラブルシューティング**: よくある問題と解決方法

### 運用ルール
- **バックアップ**: 重要な変更前にバックアップ
- **バージョン管理**: 機能追加時はバージョン番号更新
- **ログ**: タイムスタンプ付きで動作状況記録
- **終了処理**: 必ずリソースのクリーンアップ実行

## 禁止事項
- 機密情報のハードコーディング
- 適切な権限なしでのリソース操作
- クリーンアップ処理の省略
- Slack Webhook URLの直接コードへの記載
- サーボ動作範囲外の角度指定
- 安全機能をバイパスするコード

## 推奨事項
- 定期的なコードレビュー
- 実装機能のテスト確認
- エラーログの適切な管理
- 教育効果を考慮した実装

## 実行・テストコマンド
### メインアプリケーション実行
```bash
python main.py
```

### 各種テストプログラム実行
```bash
# サーボテスト
python servo_test.py

# カメラ検出テスト
python camera_detection_test.py

# サーボ初期位置設定
python servo_initial_position_setup.py

# Slack通知テスト
python slack_notification_test.py

# 単体テスト実行
python -m pytest tests/ -v
```

### コード品質チェック
```bash
# フォーマット
black *.py modules/ tests/

# 静的解析
flake8 *.py modules/ tests/
```

---
最終更新: 2025-11-02
文書番号: 12-001
変更履歴:
  - 2025-11-02: COMMENT_STYLE_GUIDE.md と python_coding_guidelines.md を参照するように更新